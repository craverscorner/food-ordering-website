"use strict";(self.webpackChunkfood_ordering_client=self.webpackChunkfood_ordering_client||[]).push([[538],{8538:(e,r,t)=>{t.r(r),t.d(r,{default:()=>ae});var s=t(5043),i=t(9252),n=t(1637),a=t(547),o=t(6446),l=t(5376),c=t(2314),d=t(5263),u=t(5865),m=t(4109),h=t(5721),x=t(1322),A=t(2050),j=t(8734),g=t(8094),p=t(1696),y=t(2500),_=t(3395),f=t(9669),v=t(2555),b=t(3336),C=t(8911),w=t(5795),S=t(1906),N=t(3193),k=t(9190),I=t(9285),q=t(2143),D=t(9650),z=t(1806),B=t(4882),P=t(8076),W=t(2420),G=t(3460),M=t(7392),E=t(35),L=t(6600),F=t(5316),O=t(8533),U=t(9347),T=t(3159),V=t(3471),H=t(9150),Y=t(579);const Q={name:"",description:"",price:"",image_url:"",category_ids:[],subcategory_ids:[]};const J=function(){const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)(Q),[l,c]=(0,s.useState)(null),[d,m]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[A,j]=(0,s.useState)(null),[g,p]=(0,s.useState)(!1),[y,_]=(0,s.useState)([]),[J,K]=(0,s.useState)([]),[R,X]=(0,s.useState)({}),[Z,$]=(0,s.useState)({}),{categorySubcategoryLinks:ee}=(0,H.b)(),re=async()=>{const{data:e,error:t}=await f.N.from("menu_items").select("*");t?m(t.message):r(e)};(0,s.useEffect)((()=>{re(),(async()=>{const{data:e,error:r}=await f.N.from("categories").select("*");!r&&e&&(_(e.filter((e=>"category"===e.type))),K(e.filter((e=>"subcategory"===e.type))))})()}),[]),(0,s.useEffect)((()=>{(async()=>{const{data:e}=await f.N.from("menu_item_subcategories").select("*"),r={};null===e||void 0===e||e.forEach((e=>{r[e.menu_item_id]||(r[e.menu_item_id]=[]),r[e.menu_item_id].push(e.subcategory_id)})),X(r);const{data:t}=await f.N.from("menu_item_categories").select("*"),s={};null===t||void 0===t||t.forEach((e=>{s[e.menu_item_id]||(s[e.menu_item_id]=[]),s[e.menu_item_id].push(e.category_id)})),$(s)})()}),[e]);const te=e=>{const{name:r,value:s}=e.target;i("subcategory_ids"===r||"category_ids"===r?(0,v.A)((0,v.A)({},t),{},{[r]:"string"===typeof s?s.split(","):s}):(0,v.A)((0,v.A)({},t),{},{[r]:s}))},se=J.filter((e=>ee.some((r=>t.category_ids.includes(r.category_id)&&r.subcategory_id===e.id))));return(0,Y.jsxs)(o.A,{sx:{mt:4},children:[(0,Y.jsx)(u.A,{variant:"h5",gutterBottom:!0,children:"Menu Management"}),d&&(0,Y.jsx)(a.A,{severity:"error",sx:{mb:2},children:d}),h&&(0,Y.jsx)(a.A,{severity:"success",sx:{mb:2},children:h}),(0,Y.jsx)(b.A,{sx:{p:2,mb:4},children:(0,Y.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),m(""),x(""),!t.name||!t.price||!t.category_ids.length)return void m("Name, price, and at least one category are required.");let r=l;if(l){const{error:e}=await f.N.from("menu_items").update({name:t.name,description:t.description,price:parseFloat(t.price),image_url:t.image_url}).eq("id",l);if(e)return void m(e.message)}else{const{data:e,error:s}=await f.N.from("menu_items").insert([{name:t.name,description:t.description,price:parseFloat(t.price),image_url:t.image_url}]).select();if(s)return void m(s.message);r=e[0].id}if(l&&await f.N.from("menu_item_categories").delete().eq("menu_item_id",l),t.category_ids.length>0){const e=t.category_ids.map((e=>({menu_item_id:r,category_id:parseInt(e)}))),{error:s}=await f.N.from("menu_item_categories").insert(e);if(s)return void m(s.message)}if(l&&await f.N.from("menu_item_subcategories").delete().eq("menu_item_id",l),t.subcategory_ids&&t.subcategory_ids.length>0){const e=t.subcategory_ids.map((e=>({menu_item_id:r,subcategory_id:parseInt(e)}))),{error:s}=await f.N.from("menu_item_subcategories").insert(e);if(s)return void m(s.message)}x(l?"Item updated!":"Item added!"),c(null),i(Q),re()},children:(0,Y.jsxs)(C.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[(0,Y.jsx)(w.A,{name:"name",label:"Item Name",value:t.name,onChange:te,required:!0,size:"small"}),(0,Y.jsx)(w.A,{name:"description",label:"Description",value:t.description,onChange:te,size:"small"}),(0,Y.jsx)(w.A,{name:"price",label:"Price",type:"number",value:t.price,onChange:te,required:!0,size:"small",inputProps:{step:"0.01"}}),(0,Y.jsx)("input",{accept:"image/*",type:"file",id:"image-upload",onChange:async e=>{const r=e.target.files[0];if(r){p(!0);try{const e=r.name.split(".").pop(),s="".concat(Math.random(),".").concat(e),{data:n,error:a}=await f.N.storage.from("menu-images").upload(s,r);if(a)throw a;const{data:{publicUrl:o}}=f.N.storage.from("menu-images").getPublicUrl(n.path);i((0,v.A)((0,v.A)({},t),{},{image_url:o}))}catch(s){m(s.message)}finally{p(!1)}}},style:{display:"none"}}),(0,Y.jsx)("label",{htmlFor:"image-upload",children:(0,Y.jsx)(S.A,{variant:"outlined",component:"span",disabled:g,children:g?(0,Y.jsx)(n.A,{size:24}):"Upload Image"})}),t.image_url&&(0,Y.jsx)(o.A,{sx:{width:100,height:100,overflow:"hidden"},children:(0,Y.jsx)("img",{src:t.image_url,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}})}),(0,Y.jsxs)(N.A,{size:"small",sx:{minWidth:120},required:!0,children:[(0,Y.jsx)(k.A,{children:"Categories"}),(0,Y.jsx)(I.A,{name:"category_ids",multiple:!0,value:t.category_ids,label:"Categories",onChange:te,renderValue:e=>e.map((e=>{var r;return null===(r=y.find((r=>r.id===e)))||void 0===r?void 0:r.name})).join(", "),children:y.map((e=>(0,Y.jsx)(q.A,{value:e.id,children:e.name},e.id)))})]}),t.category_ids.length>0&&se.length>0&&(0,Y.jsxs)(N.A,{size:"small",sx:{minWidth:120},children:[(0,Y.jsx)(k.A,{children:"Subcategories"}),(0,Y.jsx)(I.A,{name:"subcategory_ids",multiple:!0,value:t.subcategory_ids,label:"Subcategories",onChange:te,renderValue:e=>e.map((e=>{var r;return null===(r=se.find((r=>r.id===e)))||void 0===r?void 0:r.name})).join(", "),children:se.map((e=>(0,Y.jsx)(q.A,{value:e.id,children:e.name},e.id)))})]}),(0,Y.jsx)(S.A,{type:"submit",variant:"contained",color:"primary",children:l?"Update":"Add"}),l&&(0,Y.jsx)(S.A,{type:"button",variant:"outlined",color:"secondary",onClick:()=>{c(null),i(Q),m(""),x("")},children:"Cancel"})]})})}),(0,Y.jsx)(D.A,{component:b.A,children:(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(B.A,{children:(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Name"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Description"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Price"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Categories"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Subcategories"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Actions"})})]})}),(0,Y.jsx)(G.A,{children:e.map((e=>{var r;return(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:e.name}),(0,Y.jsx)(W.A,{children:e.description}),(0,Y.jsx)(W.A,{children:null===(r=e.price)||void 0===r?void 0:r.toLocaleString("en-GB",{style:"currency",currency:"GBP"})}),(0,Y.jsx)(W.A,{children:(Z[e.id]||[]).map((e=>{var r;return null===(r=y.find((r=>r.id===e)))||void 0===r?void 0:r.name})).filter(Boolean).join(", ")}),(0,Y.jsx)(W.A,{children:(R[e.id]||[]).map((e=>{var r;return null===(r=J.find((r=>r.id===e)))||void 0===r?void 0:r.name})).filter(Boolean).join(", ")}),(0,Y.jsxs)(W.A,{children:[(0,Y.jsx)(M.A,{color:"primary",onClick:()=>(async e=>{c(e.id);const{data:r}=await f.N.from("menu_item_categories").select("category_id").eq("menu_item_id",e.id),{data:t}=await f.N.from("menu_item_subcategories").select("subcategory_id").eq("menu_item_id",e.id);i({name:e.name,description:e.description,price:e.price,image_url:e.image_url,category_ids:r?r.map((e=>e.category_id)):[],subcategory_ids:t?t.map((e=>e.subcategory_id)):[]})})(e),children:(0,Y.jsx)(T.A,{})}),(0,Y.jsx)(M.A,{color:"error",onClick:()=>j(e.id),children:(0,Y.jsx)(V.A,{})})]})]},e.id)}))})]})}),(0,Y.jsxs)(E.A,{open:!!A,onClose:()=>j(null),children:[(0,Y.jsx)(L.A,{children:"Delete Menu Item"}),(0,Y.jsx)(F.A,{children:(0,Y.jsx)(O.A,{children:"Are you sure you want to delete this menu item? This action cannot be undone."})}),(0,Y.jsxs)(U.A,{children:[(0,Y.jsx)(S.A,{onClick:()=>j(null),children:"Cancel"}),(0,Y.jsx)(S.A,{onClick:async()=>{if(!A)return;const{error:e}=await f.N.from("menu_items").delete().eq("id",A);e?m(e.message):(x("Item deleted!"),re()),j(null)},color:"error",children:"Delete"})]})]})]})};var K=t(3845),R=t(8625),X=t(9778),Z=t(5502),$=t(7260);const ee=()=>{var e,r;const[t,l]=(0,s.useState)([]),[c,d]=(0,s.useState)([]),[m,h]=(0,s.useState)(!0),[x,A]=(0,s.useState)(null),[j,g]=(0,s.useState)(null),[p,y]=(0,s.useState)(!1),_=async()=>{try{h(!0),A(null);const{data:e,error:r}=await f.N.from("orders").select("*").order("created_at",{ascending:!1});if(r)throw r;const{data:t,error:s}=await f.N.from("profiles").select("id, email");if(s)throw s;const i=e.map((e=>(0,v.A)((0,v.A)({},e),{},{profiles:t.find((r=>r.id===e.user_id))})));l(i)}catch(e){console.error("Error fetching orders:",e),A(e.message)}finally{h(!1)}};(0,s.useEffect)((()=>{_()}),[]);const C=async(e,r)=>{try{const{error:t}=await f.N.from("orders").update({status:r}).eq("id",e);if(t)throw t;_()}catch(t){console.error("Error updating order:",t),A(t.message)}},w=e=>{switch(e){case"completed":return"success";case"cancelled":return"error";case"processing":return"warning";default:return"default"}};return m?(0,Y.jsx)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,Y.jsx)(n.A,{})}):(0,Y.jsxs)(i.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,Y.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,Y.jsx)(u.A,{variant:"h4",component:"h1",children:"Order Management"}),(0,Y.jsx)(M.A,{onClick:_,color:"primary",children:(0,Y.jsx)(R.A,{})})]}),x&&(0,Y.jsx)(a.A,{severity:"error",sx:{mb:2},children:x}),(0,Y.jsx)(D.A,{component:b.A,children:(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(B.A,{children:(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:"Order ID"}),(0,Y.jsx)(W.A,{children:"Customer"}),(0,Y.jsx)(W.A,{children:"Total"}),(0,Y.jsx)(W.A,{children:"Status"}),(0,Y.jsx)(W.A,{children:"Date"}),(0,Y.jsx)(W.A,{children:"Actions"})]})}),(0,Y.jsx)(G.A,{children:t.map((e=>{var r,t;return(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:e.id}),(0,Y.jsx)(W.A,{children:(null===(r=e.profiles)||void 0===r?void 0:r.email)||"Guest"}),(0,Y.jsx)(W.A,{children:null===(t=e.total)||void 0===t?void 0:t.toLocaleString("en-GB",{style:"currency",currency:"GBP"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)(K.A,{label:e.status,color:w(e.status),size:"small"})}),(0,Y.jsx)(W.A,{children:new Date(e.created_at).toLocaleString()}),(0,Y.jsx)(W.A,{children:(0,Y.jsxs)(o.A,{sx:{display:"flex",gap:1},children:[(0,Y.jsx)(M.A,{color:"primary",onClick:()=>(e=>{g(e),y(!0)})(e),size:"small",children:(0,Y.jsx)($.A,{})}),"processing"===e.status&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(M.A,{color:"success",onClick:()=>C(e.id,"completed"),size:"small",children:(0,Y.jsx)(X.A,{})}),(0,Y.jsx)(M.A,{color:"error",onClick:()=>C(e.id,"cancelled"),size:"small",children:(0,Y.jsx)(Z.A,{})})]})]})})]},e.id)}))})]})}),(0,Y.jsxs)(E.A,{open:p,onClose:()=>y(!1),maxWidth:"md",fullWidth:!0,children:[(0,Y.jsx)(L.A,{children:"Order Details"}),(0,Y.jsx)(F.A,{children:j&&(0,Y.jsxs)(o.A,{sx:{mt:2},children:[(0,Y.jsxs)(u.A,{variant:"subtitle1",gutterBottom:!0,children:["Order ID: ",j.id]}),(0,Y.jsxs)(u.A,{variant:"subtitle1",gutterBottom:!0,children:["Customer: ",(null===(e=j.profiles)||void 0===e?void 0:e.email)||"Guest"]}),(0,Y.jsxs)(u.A,{variant:"subtitle1",gutterBottom:!0,children:["Date: ",new Date(j.created_at).toLocaleString()]}),(0,Y.jsxs)(u.A,{variant:"subtitle1",gutterBottom:!0,children:["Status: ",j.status]}),(0,Y.jsxs)(u.A,{variant:"subtitle1",gutterBottom:!0,children:["Total: ",null===(r=j.total)||void 0===r?void 0:r.toLocaleString("en-GB",{style:"currency",currency:"GBP"})]}),(0,Y.jsx)(u.A,{variant:"h6",sx:{mt:2,mb:1},children:"Items:"}),(0,Y.jsx)(D.A,{children:(0,Y.jsxs)(z.A,{size:"small",children:[(0,Y.jsx)(B.A,{children:(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:"Item"}),(0,Y.jsx)(W.A,{children:"Quantity"}),(0,Y.jsx)(W.A,{children:"Price"}),(0,Y.jsx)(W.A,{children:"Subtotal"})]})}),(0,Y.jsx)(G.A,{children:j.items.map(((e,r)=>{var t,s;return(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:e.name}),(0,Y.jsx)(W.A,{children:e.quantity}),(0,Y.jsx)(W.A,{children:null===(t=e.price)||void 0===t?void 0:t.toLocaleString("en-GB",{style:"currency",currency:"GBP"})}),(0,Y.jsx)(W.A,{children:null===(s=e.price*e.quantity)||void 0===s?void 0:s.toLocaleString("en-GB",{style:"currency",currency:"GBP"})})]},r)}))})]})})]})}),(0,Y.jsx)(U.A,{children:(0,Y.jsx)(S.A,{onClick:()=>y(!1),children:"Close"})})]})]})},re={name:"",type:"category"},te={name:"",parent_category_ids:[],type:"subcategory",sort_order:0};const se=function(){const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)([]),[n,l]=(0,s.useState)(re),[c,d]=(0,s.useState)(null),[m,h]=(0,s.useState)(""),[x,A]=(0,s.useState)(""),[j,g]=(0,s.useState)(null),[p,y]=(0,s.useState)(!1),[_,H]=(0,s.useState)([]),Q=async()=>{const{data:e,error:t}=await f.N.from("categories").select("*").eq("type","category");t?h(t.message):r(e)},J=async()=>{const{data:e,error:r}=await f.N.from("categories").select("*").eq("type","subcategory");r?h(r.message):i(e)},K=async()=>{const{data:e,error:r}=await f.N.from("category_subcategory_links").select("*");r||H(e||[])};(0,s.useEffect)((()=>{Q(),J(),K()}),[]);const R=e=>{const{name:r,value:t}=e.target;l("parent_category_ids"===r?(0,v.A)((0,v.A)({},n),{},{parent_category_ids:"string"===typeof t?t.split(","):t}):(0,v.A)((0,v.A)({},n),{},{[r]:t}))},X=e=>{if(d(e.id),"subcategory"===e.type){var r;const t=_.filter((r=>r.subcategory_id===e.id));l({name:e.name,type:e.type,parent_category_ids:t.map((e=>e.category_id)),sort_order:null!==(r=e.sort_order)&&void 0!==r?r:0}),y(!0)}else l({name:e.name,type:e.type}),y(!1)};return(0,Y.jsxs)(o.A,{sx:{mt:4},children:[(0,Y.jsx)(u.A,{variant:"h5",gutterBottom:!0,children:"Category Management"}),m&&(0,Y.jsx)(a.A,{severity:"error",sx:{mb:2},children:m}),x&&(0,Y.jsx)(a.A,{severity:"success",sx:{mb:2},children:x}),(0,Y.jsx)(b.A,{sx:{p:2,mb:4},children:(0,Y.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),h(""),A(""),!n.name)return void h("Name is required.");let r=c;if(p){if(c){var t;const{error:e}=await f.N.from("categories").update({name:n.name,type:"subcategory",sort_order:null!==(t=n.sort_order)&&void 0!==t?t:0}).eq("id",c);if(e)return void h(e.message)}else{var s;const{data:e,error:t}=await f.N.from("categories").insert([{name:n.name,type:"subcategory",sort_order:null!==(s=n.sort_order)&&void 0!==s?s:0}]).select();if(t)return void h(t.message);r=e[0].id}if(c&&await f.N.from("category_subcategory_links").delete().eq("subcategory_id",c),n.parent_category_ids&&n.parent_category_ids.length>0){const e=n.parent_category_ids.map((e=>({category_id:parseInt(e),subcategory_id:r}))),{error:t}=await f.N.from("category_subcategory_links").insert(e);if(t)return void h(t.message)}return A(c?"Subcategory updated!":"Subcategory added!"),d(null),l(te),Q(),J(),void K()}const i=(0,v.A)({},n);if(c){const{error:e}=await f.N.from("categories").update(i).eq("id",c);e?h(e.message):(A("Item updated!"),d(null),l(p?te:re),Q(),J())}else{const{error:e}=await f.N.from("categories").insert([i]);e?h(e.message):(A("Item added!"),l(p?te:re),Q(),J())}},children:(0,Y.jsxs)(C.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[(0,Y.jsx)(w.A,{name:"name",label:p?"Subcategory Name":"Category Name",value:n.name,onChange:R,required:!0,size:"small"}),p&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(N.A,{size:"small",sx:{minWidth:180},required:!0,children:[(0,Y.jsx)(k.A,{id:"parent-category-label",children:"Parent Categories"}),(0,Y.jsx)(I.A,{labelId:"parent-category-label",name:"parent_category_ids",multiple:!0,value:n.parent_category_ids,label:"Parent Categories",onChange:R,renderValue:r=>r.map((r=>{var t;return null===(t=e.find((e=>e.id===r)))||void 0===t?void 0:t.name})).join(", "),children:e.map((e=>(0,Y.jsx)(q.A,{value:e.id,children:e.name},e.id)))})]}),(0,Y.jsx)(w.A,{name:"sort_order",label:"Sort Order",type:"number",value:n.sort_order||0,onChange:R,size:"small",sx:{minWidth:100}})]}),(0,Y.jsx)(S.A,{type:"button",variant:"outlined",onClick:()=>{y(!p),l(p?re:te)},children:p?"Add Category":"Add Subcategory"}),(0,Y.jsx)(S.A,{type:"submit",variant:"contained",color:"primary",children:c?"Update":"Add"}),c&&(0,Y.jsx)(S.A,{type:"button",variant:"outlined",color:"secondary",onClick:()=>{d(null),l(p?te:re),h(""),A("")},children:"Cancel"})]})})}),(0,Y.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Categories"}),(0,Y.jsx)(D.A,{component:b.A,sx:{mb:4},children:(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(B.A,{children:(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Name"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Actions"})})]})}),(0,Y.jsx)(G.A,{children:e.map((e=>(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:e.name}),(0,Y.jsxs)(W.A,{children:[(0,Y.jsx)(M.A,{color:"primary",onClick:()=>X(e),children:(0,Y.jsx)(T.A,{})}),(0,Y.jsx)(M.A,{color:"error",onClick:()=>g(e.id),children:(0,Y.jsx)(V.A,{})})]})]},e.id)))})]})}),(0,Y.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Subcategories"}),(0,Y.jsx)(D.A,{component:b.A,children:(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(B.A,{children:(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Name"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Parent Categories"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Sort Order"})}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)("b",{children:"Actions"})})]})}),(0,Y.jsx)(G.A,{children:t.sort(((e,r)=>{var t,s;return(null!==(t=e.sort_order)&&void 0!==t?t:0)-(null!==(s=r.sort_order)&&void 0!==s?s:0)})).map((r=>(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:r.name}),(0,Y.jsx)(W.A,{children:e.filter((e=>_.filter((e=>e.subcategory_id===r.id)).map((e=>e.category_id)).includes(e.id))).map((e=>e.name)).join(", ")}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)(w.A,{type:"number",value:r.sort_order||0,onChange:e=>(async(e,r)=>{await f.N.from("categories").update({sort_order:Number(r)}).eq("id",e),J()})(r.id,e.target.value),size:"small",sx:{width:60}})}),(0,Y.jsxs)(W.A,{children:[(0,Y.jsx)(M.A,{color:"primary",onClick:()=>X(r),children:(0,Y.jsx)(T.A,{})}),(0,Y.jsx)(M.A,{color:"error",onClick:()=>g(r.id),children:(0,Y.jsx)(V.A,{})})]})]},r.id)))})]})}),(0,Y.jsxs)(E.A,{open:!!j,onClose:()=>g(null),children:[(0,Y.jsx)(L.A,{children:"Delete Item"}),(0,Y.jsx)(F.A,{children:(0,Y.jsx)(O.A,{children:"Are you sure you want to delete this item? This action cannot be undone."})}),(0,Y.jsxs)(U.A,{children:[(0,Y.jsx)(S.A,{onClick:()=>g(null),children:"Cancel"}),(0,Y.jsx)(S.A,{onClick:async()=>{if(!j)return;const{error:e}=await f.N.from("categories").delete().eq("id",j);e?h(e.message):(A("Item deleted!"),Q(),J(),K()),g(null)},color:"error",children:"Delete"})]})]})]})};var ie=t(2505);const ne=()=>{const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)(!0),[l,c]=(0,s.useState)(""),[d,m]=(0,s.useState)(!1),[h,x]=(0,s.useState)(null),[A,j]=(0,s.useState)({code:"",discount_type:"percentage",discount_value:"",min_order_amount:"",max_discount:"",start_date:"",end_date:"",usage_limit:"",is_active:!0}),g=async()=>{try{i(!0);const{data:e,error:t}=await f.N.from("coupons").select("*").order("created_at",{ascending:!1});if(t)throw t;r(e)}catch(e){c(e.message)}finally{i(!1)}};(0,s.useEffect)((()=>{g()}),[]);const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var r,t;e?(x(e),j((0,v.A)((0,v.A)({},e),{},{start_date:(null===(r=e.start_date)||void 0===r?void 0:r.split("T")[0])||"",end_date:(null===(t=e.end_date)||void 0===t?void 0:t.split("T")[0])||""}))):(x(null),j({code:"",discount_type:"percentage",discount_value:"",min_order_amount:"",max_discount:"",start_date:"",end_date:"",usage_limit:"",is_active:!0}));m(!0)},y=()=>{m(!1),x(null)};return t?(0,Y.jsx)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,Y.jsx)(n.A,{})}):(0,Y.jsxs)(o.A,{children:[(0,Y.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,Y.jsx)(u.A,{variant:"h4",children:"Coupon Management"}),(0,Y.jsx)(S.A,{variant:"contained",color:"primary",startIcon:(0,Y.jsx)(ie.A,{}),onClick:()=>p(),children:"Add Coupon"})]}),l&&(0,Y.jsx)(a.A,{severity:"error",sx:{mb:2},children:l}),(0,Y.jsx)(D.A,{component:b.A,children:(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(B.A,{children:(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:"Code"}),(0,Y.jsx)(W.A,{children:"Discount"}),(0,Y.jsx)(W.A,{children:"Min. Order"}),(0,Y.jsx)(W.A,{children:"Valid Until"}),(0,Y.jsx)(W.A,{children:"Status"}),(0,Y.jsx)(W.A,{children:"Actions"})]})}),(0,Y.jsx)(G.A,{children:e.map((e=>(0,Y.jsxs)(P.A,{children:[(0,Y.jsx)(W.A,{children:e.code}),(0,Y.jsx)(W.A,{children:"percentage"===e.discount_type?"".concat(e.discount_value,"%"):"\xa3".concat(e.discount_value)}),(0,Y.jsx)(W.A,{children:e.min_order_amount?"\xa3".concat(e.min_order_amount):"No minimum"}),(0,Y.jsx)(W.A,{children:new Date(e.end_date).toLocaleDateString()}),(0,Y.jsx)(W.A,{children:(0,Y.jsx)(K.A,{label:e.is_active?"Active":"Inactive",color:e.is_active?"success":"default",size:"small"})}),(0,Y.jsxs)(W.A,{children:[(0,Y.jsx)(M.A,{color:"primary",onClick:()=>p(e),size:"small",children:(0,Y.jsx)(T.A,{})}),(0,Y.jsx)(M.A,{color:"error",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this coupon?"))try{const{error:r}=await f.N.from("coupons").delete().eq("id",e);if(r)throw r;g()}catch(r){c(r.message)}})(e.id),size:"small",children:(0,Y.jsx)(V.A,{})})]})]},e.id)))})]})}),(0,Y.jsxs)(E.A,{open:d,onClose:y,maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(L.A,{children:h?"Edit Coupon":"Add New Coupon"}),(0,Y.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=(0,v.A)((0,v.A)({},A),{},{discount_value:parseFloat(A.discount_value),min_order_amount:parseFloat(A.min_order_amount)||null,max_discount:parseFloat(A.max_discount)||null,usage_limit:parseInt(A.usage_limit)||null});if(h){const{error:r}=await f.N.from("coupons").update(e).eq("id",h.id);if(r)throw r}else{const{error:r}=await f.N.from("coupons").insert([e]);if(r)throw r}y(),g()}catch(r){c(r.message)}},children:[(0,Y.jsx)(F.A,{children:(0,Y.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,Y.jsx)(w.A,{label:"Coupon Code",value:A.code,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{code:e.target.value})),required:!0,fullWidth:!0}),(0,Y.jsxs)(w.A,{select:!0,label:"Discount Type",value:A.discount_type,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{discount_type:e.target.value})),SelectProps:{native:!0},fullWidth:!0,children:[(0,Y.jsx)("option",{value:"percentage",children:"Percentage"}),(0,Y.jsx)("option",{value:"fixed",children:"Fixed Amount"})]}),(0,Y.jsx)(w.A,{label:"Discount Value",type:"number",value:A.discount_value,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{discount_value:e.target.value})),required:!0,fullWidth:!0,InputProps:{startAdornment:"percentage"===A.discount_type?"%":"\xa3"}}),(0,Y.jsx)(w.A,{label:"Minimum Order Amount",type:"number",value:A.min_order_amount,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{min_order_amount:e.target.value})),fullWidth:!0,InputProps:{startAdornment:"\xa3"}}),(0,Y.jsx)(w.A,{label:"Maximum Discount",type:"number",value:A.max_discount,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{max_discount:e.target.value})),fullWidth:!0,InputProps:{startAdornment:"\xa3"}}),(0,Y.jsx)(w.A,{label:"Start Date",type:"date",value:A.start_date,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{start_date:e.target.value})),fullWidth:!0,InputLabelProps:{shrink:!0}}),(0,Y.jsx)(w.A,{label:"End Date",type:"date",value:A.end_date,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{end_date:e.target.value})),required:!0,fullWidth:!0,InputLabelProps:{shrink:!0}}),(0,Y.jsx)(w.A,{label:"Usage Limit",type:"number",value:A.usage_limit,onChange:e=>j((0,v.A)((0,v.A)({},A),{},{usage_limit:e.target.value})),fullWidth:!0})]})}),(0,Y.jsxs)(U.A,{children:[(0,Y.jsx)(S.A,{onClick:y,children:"Cancel"}),(0,Y.jsx)(S.A,{type:"submit",variant:"contained",color:"primary",children:h?"Update":"Create"})]})]})]})]})},ae=()=>{const[e,r]=(0,s.useState)(!0),[t,v]=(0,s.useState)(!1),[b,C]=(0,s.useState)(""),[w,S]=(0,s.useState)("dashboard");return(0,s.useEffect)((()=>{(async()=>{r(!0),C("");const{data:{user:e},error:t}=await f.N.auth.getUser();if(t||!e)return C("You must be logged in."),void r(!1);const{data:s,error:i}=await f.N.from("profiles").select("role").eq("id",e.id).single();if(i||!s)return C("Profile not found."),void r(!1);"admin"===s.role?v(!0):C("You are not authorized to view this page."),r(!1)})()}),[]),e?(0,Y.jsx)(i.A,{maxWidth:"md",sx:{mt:8,textAlign:"center"},children:(0,Y.jsx)(n.A,{})}):b?(0,Y.jsx)(i.A,{maxWidth:"sm",sx:{mt:8},children:(0,Y.jsx)(a.A,{severity:"error",children:b})}):(0,Y.jsxs)(o.A,{sx:{display:"flex"},children:[(0,Y.jsx)(l.Ay,{}),(0,Y.jsx)(c.A,{position:"fixed",sx:{zIndex:e=>e.zIndex.drawer+1},children:(0,Y.jsx)(d.A,{children:(0,Y.jsx)(u.A,{variant:"h6",noWrap:!0,component:"div",children:"Admin Dashboard"})})}),(0,Y.jsxs)(m.Ay,{variant:"permanent",sx:{width:220,flexShrink:0,"& .MuiDrawer-paper":{width:220,boxSizing:"border-box"}},children:[(0,Y.jsx)(d.A,{}),(0,Y.jsx)(o.A,{sx:{overflow:"auto"},children:(0,Y.jsxs)(h.A,{children:[(0,Y.jsxs)(x.Ay,{button:!0,selected:"dashboard"===w,onClick:()=>S("dashboard"),children:[(0,Y.jsx)(A.A,{children:(0,Y.jsx)(g.A,{})}),(0,Y.jsx)(j.A,{primary:"Dashboard Home"})]}),(0,Y.jsxs)(x.Ay,{button:!0,selected:"menu"===w,onClick:()=>S("menu"),children:[(0,Y.jsx)(A.A,{children:(0,Y.jsx)(p.A,{})}),(0,Y.jsx)(j.A,{primary:"Menu Management"})]}),(0,Y.jsxs)(x.Ay,{button:!0,selected:"categories"===w,onClick:()=>S("categories"),children:[(0,Y.jsx)(A.A,{children:(0,Y.jsx)(y.A,{})}),(0,Y.jsx)(j.A,{primary:"Categories & Subcategories"})]}),(0,Y.jsxs)(x.Ay,{button:!0,selected:"orders"===w,onClick:()=>S("orders"),children:[(0,Y.jsx)(A.A,{children:(0,Y.jsx)(p.A,{})}),(0,Y.jsx)(j.A,{primary:"Orders"})]}),(0,Y.jsxs)(x.Ay,{button:!0,selected:"coupons"===w,onClick:()=>S("coupons"),children:[(0,Y.jsx)(A.A,{children:(0,Y.jsx)(_.A,{})}),(0,Y.jsx)(j.A,{primary:"Coupons & Offers"})]})]})})]}),(0,Y.jsxs)(o.A,{component:"main",sx:{flexGrow:1,p:3},children:[(0,Y.jsx)(d.A,{}),"dashboard"===w&&(0,Y.jsxs)(o.A,{children:[(0,Y.jsx)(u.A,{variant:"h4",gutterBottom:!0,children:"Welcome, Admin!"}),(0,Y.jsx)(u.A,{variant:"body1",children:"Use the side menu to manage menu items and more."})]}),"menu"===w&&(0,Y.jsx)(J,{}),"categories"===w&&(0,Y.jsx)(se,{}),"orders"===w&&(0,Y.jsx)(ee,{}),"coupons"===w&&(0,Y.jsx)(ne,{})]})]})}}}]);
//# sourceMappingURL=538.e892203f.chunk.js.map